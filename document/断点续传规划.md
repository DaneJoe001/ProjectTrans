### 断点续传项目

#### 业务逻辑部分

1. **客户端发送文件下载请求**

   **请求消息：**

   | 消息类型     | 消息长度                     | 文件编号 |
   | ------------ | ---------------------------- | -------- |
   | 固定字节长度 | 由文件标识计算，字节长度固定 |          |

2. **服务端接收到文件下载请求**

   - 从数据库中读取文件信息

   **响应消息：**

   | 消息类型 | 消息长度 | 文件编号 | 文件名称 | 文件大小 | 校验码 |
   | -------- | -------- | -------- | -------- | -------- | -------- | 
   |          |          |          |          |          |          |

3. **客户端接收文件详细信息**

   - 根据下载设置和文件大小动态确定分块请求大小，并记录至数据库块请求表中：


4. **下载请求模块**

   - 遍历块请求表逐步请求块信息，并写入文件。
   - 成功写入文件时，修改对应记录状态。
   - 当请求表中对应文件块全部请求成功且校验码验算正确时则代表文件传输成功，否则重置下载状态并重新发送文件下载请求。

   **请求消息：**

   | 消息类型 | 消息长度 | 文件编号 | 块偏移 | 块大小 |
   | -------- | -------- | -------- | ------ | ------ |
   |          |          |          |        |        |

   **响应消息：**

   | 消息类型 | 消息长度 | 文件编号 | 块偏移 | 块大小 | 块数据 |
   | -------- | -------- | -------- | ------ | ------ | ------ |
   |          |          |          |        |        |        |

#### 客户端表设计

1. **文件信息表：**

   | 文件编号 | 目标文件名称 | 文件大小 | 文件校验码 | 目标位置 | 创建时间 | 完成状态 |
   | -------- | -------- | -------- | ---------- | -------- | -------- | -------- |
   |          |          |          |            |          |          |          |

2. **块请求表：**

   | 块编号 | 文件编号 | 块偏移 | 块大小 | 请求时间 | 完成状态 |
   | ------ | -------- | ------ | ------ | -------- | -------- |
   |        |          |        |        |          |          |

#### 服务端表设计

1. **文件信息表：**

   | 文件编号 | 文件名称 | 文件大小 | 文件路径 | 校验码 |
   | -------- | -------- | -------- | -------- | ------ |
   |          |          |          |          |        |

---

#### 扩展部分

graph TD
    A[客户端发送文件下载请求] -->|请求消息| B[服务端接收到文件下载请求]
    B -->|读取文件信息| C[服务端响应文件详细信息]
    C -->|响应消息| D[客户端接收文件详细信息]
    D --> E[根据下载设置和文件大小确定分块请求大小]
    E --> F[记录至数据库块请求表中]
    F --> G[下载请求模块]
    G -->|遍历块请求表| H[请求文件块信息]
    H -->|请求消息| I[服务端返回块数据]
    I -->|响应消息| J[客户端写入文件]
    J --> K[修改对应记录状态]
    K --> L{"所有块请求成功?"}
    L -->|是| M{"校验码验算正确?"}
    L -->|否| N[重置下载状态并重新发送下载请求]
    M -->|是| O[文件传输成功]
    M -->|否| N